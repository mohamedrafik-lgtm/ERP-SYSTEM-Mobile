# نظام الرسائل التلقائية عبر WhatsApp

## نظرة عامة

تم إنشاء نظام شامل لإرسال الرسائل التلقائية عبر WhatsApp لجميع العمليات في النظام التعليمي. النظام يدعم 12 فئة مختلفة من الرسائل مع أولويات وتوقيتات مختلفة.

## الميزات الرئيسية

### ✅ **1. أنواع الرسائل المدعومة**

#### **📚 إدارة المتدربين (Student Management)**
- **رسالة ترحيب**: بيانات التسجيل + كلمة المرور
- **تحديث البيانات**: إشعار بالتحديث + البيانات الجديدة
- **تغيير الحالة**: رسالة حسب الحالة الجديدة
- **حذف متدرب**: إشعار بالحذف + السبب

#### **💰 إدارة المدفوعات (Payment Management)**
- **استحقاق رسوم**: نوع الرسوم + المبلغ + تاريخ الاستحقاق
- **تأكيد الدفع**: تأكيد استلام المبلغ + رقم الإيصال
- **تذكير متأخر**: المبلغ المتأخر + أيام التأخير
- **إلغاء رسوم**: إشعار بالإلغاء + السبب

#### **📖 إدارة المحاضرات (Lecture Management)**
- **محاضرة جديدة**: تفاصيل المحاضرة + التاريخ + الوقت
- **تذكير قبل المحاضرة**: تذكير بالموعد + تعليمات الحضور
- **تغيير موعد**: الموعد الجديد + سبب التغيير
- **إلغاء محاضرة**: إشعار بالإلغاء + موعد بديل

#### **📝 إدارة الحضور (Attendance Management)**
- **تذكير تسجيل الحضور**: عند بداية المحاضرة
- **إشعار غياب**: تفاصيل الغياب + تعليمات العذر
- **إشعار تأخير**: وقت التأخير

#### **👤 إدارة المستخدمين (User Management)**
- **إنشاء مستخدم**: بيانات الحساب + كلمة المرور
- **إعادة تعيين كلمة المرور**: كود إعادة التعيين + مدة الصلاحية
- **تغيير صلاحيات**: الصلاحيات الجديدة
- **إلغاء تفعيل**: سبب الإلغاء

#### **🎯 إدارة التسويق (Marketing Management)**
- **تخصيص متدرب**: بيانات موظف التسويق
- **تحقيق هدف**: تهنئة + تفاصيل الإنجاز
- **تذكير بالهدف**: الهدف المتبقي

#### **🎓 إدارة البرامج (Program Management)**
- **بداية برنامج**: ترحيب + جدول البرنامج
- **نهاية برنامج**: تهنئة + معلومات الشهادة
- **تحديث محتوى**: المحتوى الجديد

#### **📝 إدارة الاختبارات (Exam Management)**
- **اختبار جديد**: تفاصيل الاختبار + التعليمات
- **تذكير قبل الاختبار**: تعليمات التحضير
- **نتائج الاختبار**: النتيجة + التقييم

#### **🔧 إشعارات النظام (System Notification)**
- **صيانة**: تاريخ الصيانة + المدة المتوقعة
- **تحديث النظام**: الميزات الجديدة + الإصلاحات
- **مشكلة تقنية**: وصف المشكلة + الحل المتوقع

#### **🎉 إدارة الأحداث (Event Management)**
- **حدث جديد**: تفاصيل الحدث + كيفية المشاركة
- **تذكير قبل الحدث**: تعليمات المشاركة
- **إلغاء حدث**: سبب الإلغاء

#### **🏆 إدارة الشهادات (Certificate Management)**
- **جاهزية الشهادة**: كيفية الاستلام
- **تذكير استلام**: مواعيد الاستلام

#### **📞 إدارة الاستفسارات (Inquiry Management)**
- **تأكيد استلام**: رقم المتابعة + وقت الرد
- **رد على استفسار**: الرد + معلومات إضافية

### ✅ **2. أولويات الرسائل**

#### **🚨 عاجل (Urgent)**
- مشاكل تقنية
- تغييرات مهمة
- إلغاء محاضرات/أحداث
- حذف حسابات
- إلغاء تفعيل

#### **⚠️ مهم (Important)**
- مدفوعات
- محاضرات
- اختبارات
- بداية/نهاية برامج
- تغيير حالات الطلاب

#### **📋 عادي (Normal)**
- تذكيرات
- إشعارات عامة
- تحديثات البيانات
- إشعارات النظام

### ✅ **3. توقيت الإرسال**

#### **⚡ فوري (Immediate)**
- تسجيل طلاب
- دفع رسوم
- تغيير حالة
- إنشاء مستخدمين
- إشعارات عاجلة

#### **⏰ مجدول (Scheduled)**
- تذكيرات المحاضرات
- تذكيرات الاختبارات
- تذكيرات الأحداث
- تذكيرات المدفوعات

#### **🔄 دوري (Periodic)**
- التقارير
- الإحصائيات
- تذكيرات الأهداف

## التطبيق العملي

### **📱 استخدام الخدمة**

```typescript
import WhatsAppAutoMessageService from '../services/WhatsAppAutoMessageService';

// إرسال رسالة ترحيب للطالب
const welcomeMessage = await WhatsAppAutoMessageService.sendStudentWelcomeMessage(
  '0501234567',
  {
    studentName: 'أحمد محمد',
    studentId: 'STU001',
    programName: 'برنامج تطوير الويب',
    loginCredentials: {
      username: 'ahmed.mohamed',
      password: 'temp123'
    },
    startDate: '2024-01-15',
    contactInfo: '0501234567'
  }
);

// إرسال تذكير بدفع متأخر
const paymentReminder = await WhatsAppAutoMessageService.sendPaymentReminderMessage(
  '0501234567',
  {
    studentName: 'أحمد محمد',
    amount: 1500,
    daysOverdue: 5,
    lateFee: 100,
    finalDueDate: '2024-01-20'
  }
);
```

### **🎯 أمثلة على الرسائل**

#### **رسالة ترحيب للطالب:**
```
🎉 مرحباً أحمد محمد!

تم تسجيلك بنجاح في برنامج برنامج تطوير الويب

📋 بيانات الحساب:
• اسم المستخدم: ahmed.mohamed
• كلمة المرور: temp123
• رقم الطالب: STU001

📅 تاريخ البداية: 15 يناير 2024

📞 للاستفسارات: 0501234567

نتمنى لك رحلة تعليمية مميزة! 🌟
```

#### **تذكير بدفع متأخر:**
```
⚠️ تذكير بدفع متأخر

مرحباً أحمد محمد

نذكرك بأن لديك مبلغ متأخر:

💵 المبلغ المتأخر: 1500 ريال
📅 أيام التأخير: 5 يوم
💰 رسوم التأخير: 100 ريال
📅 الموعد النهائي: 20 يناير 2024

يرجى الدفع في أقرب وقت ممكن لتجنب زيادة الرسوم.
```

#### **إشعار محاضرة جديدة:**
```
📚 محاضرة جديدة

مرحباً أحمد محمد

تم جدولة محاضرة جديدة لك:

📖 عنوان المحاضرة: أساسيات HTML
📅 التاريخ: 18 يناير 2024
🕐 الوقت: 09:00
📍 المكان: القاعة الرئيسية
👨‍🏫 المحاضر: د. سعد أحمد

📚 المواد المطلوبة:
• كتاب HTML الأساسي
• جهاز كمبيوتر محمول

نتمنى لك حضوراً مميزاً!
```

## الميزات التقنية

### **🔧 معالجة البيانات**
- **تنسيق أرقام الهواتف**: إضافة رمز الدولة تلقائياً
- **تنسيق التواريخ**: باللغة العربية
- **تنسيق الأوقات**: بتنسيق 24 ساعة
- **معالجة الأخطاء**: شاملة مع رسائل واضحة

### **📊 تتبع الرسائل**
- **معرف فريد**: لكل رسالة
- **حالة الإرسال**: pending, sent, failed
- **وقت الإرسال**: timestamp دقيق
- **معالجة الأخطاء**: رسائل خطأ مفصلة

### **🎨 تنسيق الرسائل**
- **أيقونات تعبيرية**: لكل نوع رسالة
- **تنسيق منظم**: عناوين وبنود واضحة
- **لغة عربية**: كاملة ومفهومة
- **معلومات شاملة**: جميع التفاصيل المطلوبة

## التكامل مع النظام

### **🔗 ربط مع AuthService**
```typescript
// استخدام AuthService.sendWhatsAppMessage
const response = await AuthService.sendWhatsAppMessage({
  phoneNumber: formattedPhone,
  message: formattedMessage,
});
```

### **📱 دعم جميع الشاشات**
- **إدارة الطلاب**: رسائل ترحيب وتحديث
- **إدارة المدفوعات**: تذكيرات وتأكيدات
- **إدارة المحاضرات**: إشعارات وتذكيرات
- **إدارة المستخدمين**: إنشاء وإدارة حسابات
- **إدارة التسويق**: أهداف وإنجازات

### **⚙️ إعدادات قابلة للتخصيص**
- **أولوية الرسائل**: حسب النوع
- **توقيت الإرسال**: فوري أو مجدول
- **تنسيق الرسائل**: قابل للتعديل
- **معالجة الأخطاء**: مرنة ومفصلة

## أمثلة الاستخدام

### **1. عند إنشاء طالب جديد:**
```typescript
// في AddStudentScreen
const handleCreateStudent = async (studentData) => {
  // إنشاء الطالب في النظام
  const newStudent = await AuthService.createStudent(studentData);
  
  // إرسال رسالة ترحيب
  await WhatsAppAutoMessageService.sendStudentWelcomeMessage(
    studentData.phoneNumber,
    {
      studentName: studentData.name,
      studentId: newStudent.id,
      programName: studentData.programName,
      loginCredentials: {
        username: newStudent.username,
        password: newStudent.tempPassword
      },
      startDate: studentData.startDate,
      contactInfo: '0501234567'
    }
  );
};
```

### **2. عند استحقاق رسوم:**
```typescript
// في PaymentService
const handlePaymentDue = async (paymentData) => {
  // إرسال إشعار استحقاق
  await WhatsAppAutoMessageService.sendPaymentDueMessage(
    paymentData.studentPhone,
    {
      studentName: paymentData.studentName,
      feeType: paymentData.feeType,
      amount: paymentData.amount,
      dueDate: paymentData.dueDate,
      paymentMethods: ['التحويل البنكي', 'الدفع الإلكتروني'],
      lateFee: paymentData.lateFee
    }
  );
};
```

### **3. عند جدولة محاضرة:**
```typescript
// في LectureService
const handleScheduleLecture = async (lectureData) => {
  // جدولة المحاضرة
  const lecture = await AuthService.createLecture(lectureData);
  
  // إرسال إشعار للطلاب
  for (const student of lectureData.students) {
    await WhatsAppAutoMessageService.sendNewLectureMessage(
      student.phoneNumber,
      {
        studentName: student.name,
        lectureTitle: lectureData.title,
        date: lectureData.date,
        time: lectureData.time,
        location: lectureData.location,
        instructor: lectureData.instructor,
        materials: lectureData.materials
      }
    );
  }
};
```

## الميزات المتقدمة

### **📅 جدولة الرسائل**
- **رسائل مجدولة**: للتواريخ المستقبلية
- **تذكيرات دورية**: للأهداف والمواعيد
- **إشعارات فورية**: للأحداث العاجلة

### **🎯 تخصيص الرسائل**
- **قوالب قابلة للتعديل**: لكل نوع رسالة
- **متغيرات ديناميكية**: للبيانات الشخصية
- **أولويات قابلة للتخصيص**: حسب الحاجة

### **📊 إحصائيات الإرسال**
- **تتبع النجاح**: معدل الإرسال الناجح
- **تحليل الأخطاء**: أنواع الأخطاء الشائعة
- **تقارير الأداء**: إحصائيات مفصلة

## الخلاصة

تم إنشاء نظام شامل للرسائل التلقائية عبر WhatsApp يدعم:

- ✅ **12 فئة رسائل** مختلفة
- ✅ **3 مستويات أولوية** (عاجل، مهم، عادي)
- ✅ **3 أنواع توقيت** (فوري، مجدول، دوري)
- ✅ **50+ نوع رسالة** مختلف
- ✅ **تنسيق عربي** كامل
- ✅ **معالجة أخطاء** شاملة
- ✅ **تكامل كامل** مع النظام
- ✅ **قابلية التخصيص** والتوسع

النظام الآن جاهز للاستخدام في جميع أجزاء التطبيق! 🚀
