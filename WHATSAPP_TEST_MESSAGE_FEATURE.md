# ููุฒุฉ ุงุฎุชุจุงุฑ ุฅุฑุณุงู ุงูุฑุณุงุฆู ูู WhatsApp

## ุงูุชุญุฏูุซุงุช ุงูููุฌุฒุฉ

ุชู ุฅุถุงูุฉ ูุณู ุงุฎุชุจุงุฑ ุฅุฑุณุงู ุงูุฑุณุงุฆู ููุง ูู ููุถุญ ูู ุงูุชุตููู ุงููุทููุจุ ูุน ุฑุจุท ูุงูู ูุน Backend API.

### โ **1. ุฅุถุงูุฉ Types ููุฑุณุงุฆู**

#### **ููู: `src/types/whatsapp.ts`**
```typescript
export interface WhatsAppSendMessageRequest {
  phoneNumber: string;
  message: string;
}

export interface WhatsAppSendMessageResponse {
  success: boolean;
  messageId?: string;
  error?: string;
}
```

### โ **2. ุฅุถุงูุฉ sendWhatsAppMessage Method ูู AuthService**

#### **ููู: `src/services/AuthService.ts`**
```typescript
// WhatsApp Management: Send test message
static async sendWhatsAppMessage(data: WhatsAppSendMessageRequest): Promise<WhatsAppSendMessageResponse> {
  try {
    const token = await this.getToken();
    if (!token) {
      throw new Error('Authentication token not found.');
    }

    const url = 'http://10.0.2.2:4000/api/whatsapp/send-message';
    console.log('[AuthService] Sending WhatsApp message to URL:', url);
    console.log('[AuthService] Message data:', data);

    const response = await fetch(url, {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${token}`,
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(data),
    });

    if (!response.ok) {
      if (response.status === 401) {
        await this.clearAuthData();
        throw new Error('Authentication expired. Please login again.');
      }
      const errorText = await response.text();
      throw new Error(errorText || `Failed to send WhatsApp message: ${response.status}`);
    }

    const responseData = await response.json();
    console.log('[AuthService] WhatsApp message response:', responseData);
    return responseData;
  } catch (error) {
    console.error('[AuthService] Error sending WhatsApp message:', error);
    throw error;
  }
}
```

### โ **3. ุฅูุดุงุก ูููู WhatsAppTestMessage**

#### **ููู: `src/components/WhatsAppTestMessage.tsx`**

**ุงูููุฒุงุช:**
- **ุชุตููู ูุทุงุจู ููุตูุฑุฉ**: ุนููุงูุ ุญููู ุฅุฏุฎุงูุ ุฃุฒุฑุงุฑ
- **ุญูู ุฑูู ุงููุงุชู**: ูุน validation ูุชูุณูู ุชููุงุฆู
- **ุญูู ูุญุชูู ุงูุฑุณุงูุฉ**: textarea ูุชุนุฏุฏ ุงูุฃุณุทุฑ
- **ุฃุฒุฑุงุฑ ุงูุฅุฌุฑุงุกุงุช**: ุฅุฑุณุงู ููุณุญ
- **Loading states**: ูุคุดุฑ ุชุญููู ุฃุซูุงุก ุงูุฅุฑุณุงู
- **Validation**: ุชุญูู ูู ุตุญุฉ ุงูุจูุงูุงุช
- **Error handling**: ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ูุน ุฑุณุงุฆู ูุงุถุญุฉ

**ุงูุชุตููู:**
- **Header**: "ุงุฎุชุจุงุฑ ุฅุฑุณุงู ุงูุฑุณุงุฆู" ูุน ุฃููููุฉ ุทุงุฆุฑุฉ ูุฑููุฉ
- **Input Fields**: ุฑูู ุงููุงุชู ููุญุชูู ุงูุฑุณุงูุฉ ุฌูุจุงู ุฅูู ุฌูุจ
- **Labels**: ูุน ุฃููููุงุช ููุงุณุจุฉ (dialpad ูููุงุชูุ chat-bubble ููุฑุณุงูุฉ)
- **Send Button**: "ุฅุฑุณุงู ุฑุณุงูุฉ ุชุฌุฑูุจูุฉ" ูุน ุฃููููุฉ ุทุงุฆุฑุฉ ูุฑููุฉ
- **Clear Button**: ุฒุฑ ูุณุญ ุงููููุฐุฌ

### โ **4. Validation ูError Handling**

#### **Phone Number Validation:**
```typescript
const validatePhoneNumber = (phone: string): boolean => {
  // Remove any non-digit characters
  const cleanPhone = phone.replace(/\D/g, '');
  
  // Check if it's a valid phone number (8-15 digits)
  if (cleanPhone.length < 8 || cleanPhone.length > 15) {
    return false;
  }
  
  // Check if it starts with valid prefixes
  const validPrefixes = ['966', '20', '971', '965', '973', '974', '975', '976', '977', '978', '979'];
  const hasValidPrefix = validPrefixes.some(prefix => cleanPhone.startsWith(prefix));
  
  return hasValidPrefix || cleanPhone.length >= 10;
};
```

#### **Phone Number Formatting:**
```typescript
const formatPhoneNumber = (phone: string): string => {
  // Remove any non-digit characters
  const cleanPhone = phone.replace(/\D/g, '');
  
  // If it doesn't start with country code, add Saudi Arabia code
  if (!cleanPhone.startsWith('966') && cleanPhone.length === 9) {
    return `966${cleanPhone}`;
  }
  
  return cleanPhone;
};
```

#### **Error Handling:**
- **Empty Fields**: ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ ููุญููู ุงููุงุฑุบุฉ
- **Invalid Phone**: ุชุญูู ูู ุตุญุฉ ุฑูู ุงููุงุชู
- **API Errors**: ูุนุงูุฌุฉ ุฃุฎุทุงุก ุงูุฎุงุฏู
- **Network Errors**: ูุนุงูุฌุฉ ุฃุฎุทุงุก ุงูุดุจูุฉ
- **Toast Messages**: ุฑุณุงุฆู ุชูุจูู ุจุงููุบุฉ ุงูุนุฑุจูุฉ

### โ **5. ุฅุถุงูุฉ ุงููููู ููุตูุญุฉ**

#### **ููู: `src/screens/WhatsAppManagementScreen.tsx`**
```typescript
import WhatsAppTestMessage from '../components/WhatsAppTestMessage';

// ูู JSX
<WhatsAppTestMessage />
```

ุชู ุฅุถุงูุฉ ุงููููู ุจุนุฏ ูุณู ูุนูููุงุช ุงูุงุชุตุงู ูุจุงุดุฑุฉ.

## API Endpoint

### **POST /api/whatsapp/send-message**

**Request Body:**
```json
{
  "phoneNumber": "01012345678",
  "message": "Hello, this is a test message"
}
```

**Response Success:**
```json
{
  "success": true,
  "messageId": "msg_123456789"
}
```

**Response Error:**
```json
{
  "success": false,
  "error": "Invalid phone number"
}
```

## ุชุฏูู ุงูุนูู

### **1. ุฅุฏุฎุงู ุงูุจูุงูุงุช:**
1. ุงููุณุชุฎุฏู ูุฏุฎู ุฑูู ุงููุงุชู
2. ุงููุณุชุฎุฏู ูุฏุฎู ูุญุชูู ุงูุฑุณุงูุฉ (ุงูุชุฑุงุถู: "ุฑุณุงูุฉ ุชุฌุฑูุจูุฉ")
3. ุงููุธุงู ูุชุญูู ูู ุตุญุฉ ุงูุจูุงูุงุช

### **2. Validation:**
1. **ุฑูู ุงููุงุชู**: ุชุญูู ูู ุงูุทูู ูุงูุตูุบุฉ
2. **ูุญุชูู ุงูุฑุณุงูุฉ**: ุชุญูู ูู ุนุฏู ุงููุฑุงุบ
3. **ุชูุณูู ุงูุฑูู**: ุฅุถุงูุฉ ุฑูุฒ ุงูุฏููุฉ ุฅุฐุง ูุฒู ุงูุฃูุฑ

### **3. ุงูุฅุฑุณุงู:**
1. ุฅุฑุณุงู ุงูุจูุงูุงุช ุฅูู API
2. ุนุฑุถ ูุคุดุฑ ุงูุชุญููู
3. ุงูุชุธุงุฑ ุงูุงุณุชุฌุงุจุฉ

### **4. ุงููุชูุฌุฉ:**
1. **ูุฌุงุญ**: ุฑุณุงูุฉ ูุฌุงุญ + ูุณุญ ุงููููุฐุฌ
2. **ูุดู**: ุฑุณุงูุฉ ุฎุทุฃ ูุงุถุญุฉ
3. **ุฎุทุฃ**: ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ูุน ุฑุณุงุฆู ููุงุณุจุฉ

## ุงูููุฒุงุช ุงูุชูููุฉ

### **๐ฑ ุชุฌุฑุจุฉ ูุณุชุฎุฏู ูุญุณูุฉ:**
- **ุชุตููู ูุทุงุจู**: ููุง ูู ููุถุญ ูู ุงูุตูุฑุฉ
- **ุฃููููุงุช ูุงุถุญุฉ**: dialpad ูููุงุชูุ chat-bubble ููุฑุณุงูุฉ
- **ุฃููุงู ูุชุณูุฉ**: ูุน ุจุงูู ุงูุชุทุจูู
- **ุชุฎุทูุท ูุชุฌุงูุจ**: ูุนูู ุนูู ุฌููุน ุงูุฃุญุฌุงู

### **๐ Validation ุฐูู:**
- **ุชุญูู ูู ุฑูู ุงููุงุชู**: ุทูู ูุตูุบุฉ ุตุญูุญุฉ
- **ุฏุนู ุฑููุฒ ุงูุฏูู**: ุชูุณูู ุชููุงุฆู
- **ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ**: ุจุงููุบุฉ ุงูุนุฑุจูุฉ
- **ููุน ุงูุฅุฑุณุงู**: ุนูุฏ ูุฌูุฏ ุฃุฎุทุงุก

### **โก Performance ูุญุณู:**
- **Loading states**: ูุคุดุฑุงุช ุชุญููู ูุงุถุญุฉ
- **Disabled states**: ููุน ุงูุฅุฏุฎุงู ุฃุซูุงุก ุงูุฅุฑุณุงู
- **Error recovery**: ุฅููุงููุฉ ุงููุญุงููุฉ ูุฑุฉ ุฃุฎุฑู
- **Form reset**: ูุณุญ ุงููููุฐุฌ ุจุนุฏ ุงููุฌุงุญ

### **๐ก๏ธ ูุนุงูุฌุฉ ุฃุฎุทุงุก ุดุงููุฉ:**
- **Network errors**: ุฃุฎุทุงุก ุงูุดุจูุฉ
- **API errors**: ุฃุฎุทุงุก ุงูุฎุงุฏู
- **Validation errors**: ุฃุฎุทุงุก ุงูุชุญูู
- **Authentication errors**: ุฃุฎุทุงุก ุงููุตุงุฏูุฉ

## ุงูุงุฎุชุจุงุฑ

### **1. ุงุฎุชุจุงุฑ ุงูุฅุฏุฎุงู:**
- ุฃุฏุฎู ุฑูู ูุงุชู ุตุญูุญ
- ุฃุฏุฎู ูุญุชูู ุฑุณุงูุฉ
- ุชุฃูุฏ ูู ุนูู ุงูุญููู

### **2. ุงุฎุชุจุงุฑ Validation:**
- ุฌุฑุจ ุฑูู ูุงุชู ูุตูุฑ ุฌุฏุงู
- ุฌุฑุจ ุฑูู ูุงุชู ุทููู ุฌุฏุงู
- ุฌุฑุจ ุชุฑู ุงูุญููู ูุงุฑุบุฉ
- ุชุฃูุฏ ูู ุธููุฑ ุฑุณุงุฆู ุงูุฎุทุฃ

### **3. ุงุฎุชุจุงุฑ ุงูุฅุฑุณุงู:**
- ุฃุฏุฎู ุจูุงูุงุช ุตุญูุญุฉ
- ุงุถุบุท "ุฅุฑุณุงู ุฑุณุงูุฉ ุชุฌุฑูุจูุฉ"
- ุชุฃูุฏ ูู ุธููุฑ ูุคุดุฑ ุงูุชุญููู
- ุชุฃูุฏ ูู ุงููุชูุฌุฉ (ูุฌุงุญ/ูุดู)

### **4. ุงุฎุชุจุงุฑ ุงููุณุญ:**
- ุฃุฏุฎู ุจูุงูุงุช ูู ุงููููุฐุฌ
- ุงุถุบุท "ูุณุญ"
- ุชุฃูุฏ ูู ูุณุญ ุฌููุน ุงูุจูุงูุงุช
- ุชุฃูุฏ ูู ุนูุฏุฉ ุงูููู ุงูุงูุชุฑุงุถูุฉ

## ุงูููุฒุงุช ุงูุฅุถุงููุฉ

### **๐ฏ ุชูุณูู ุชููุงุฆู ูููุงุชู:**
- **ุฅุถุงูุฉ ุฑูุฒ ุงูุฏููุฉ**: ุชููุงุฆูุงู ููุณุนูุฏูุฉ
- **ุชูุธูู ุงูุฑูู**: ุฅุฒุงูุฉ ุงูุฑููุฒ ุบูุฑ ุงููุฑุบูุจุฉ
- **ุฏุนู ุชูุณููุงุช ูุชุนุฏุฏุฉ**: ูุน ุฃู ุจุฏูู ุฑูุฒ ุงูุฏููุฉ

### **๐ฌ ุฑุณุงุฆู ุงูุชุฑุงุถูุฉ:**
- **ุฑุณุงูุฉ ุชุฌุฑูุจูุฉ**: "ุฑุณุงูุฉ ุชุฌุฑูุจูุฉ" ูุงูุชุฑุงุถู
- **ูุงุจู ููุชุนุฏูู**: ูููู ุชุบููุฑ ุงููุญุชูู
- **ุญูุธ ุงููุญุชูู**: ุฃุซูุงุก ุงูุชุนุฏูู

### **๐ ุฅุนุงุฏุฉ ุงูุงุณุชุฎุฏุงู:**
- **ูุณุญ ุงููููุฐุฌ**: ุจุนุฏ ุงูุฅุฑุณุงู ุงููุงุฌุญ
- **ุฅุนุงุฏุฉ ุงููุญุงููุฉ**: ุนูุฏ ุงููุดู
- **ุญูุธ ุงูุจูุงูุงุช**: ุฃุซูุงุก ุงููุชุงุจุฉ

## ุงูุฎุทูุงุช ุงูุชุงููุฉ

### **1. ููุฒุงุช ูุชูุฏูุฉ:**
- **ููุงูุจ ุฑุณุงุฆู**: ุฑุณุงุฆู ุฌุงูุฒุฉ ููุงุณุชุฎุฏุงู
- **ุชุงุฑูุฎ ุงูุฅุฑุณุงู**: ุณุฌู ุงูุฑุณุงุฆู ุงููุฑุณูุฉ
- **ุฅุญุตุงุฆูุงุช**: ุนุฏุฏ ุงูุฑุณุงุฆู ุงููุฑุณูุฉ
- **ุฌุฏููุฉ**: ุฅุฑุณุงู ูุคุฌู

### **2. ุชุญุณููุงุช UI:**
- **ุฃููููุงุช ูุชุญุฑูุฉ**: ุฃุซูุงุก ุงูุฅุฑุณุงู
- **ุชุฃููุฏ ุงูุฅุฑุณุงู**: ูุงูุฐุฉ ุชุฃููุฏ
- **ูุนุงููุฉ ุงูุฑุณุงูุฉ**: ูุจู ุงูุฅุฑุณุงู
- **ุชูุณูู ุงููุต**: ุฏุนู Markdown

### **3. ููุฒุงุช ุฃูุงู:**
- **ุญุฏ ุงูุฅุฑุณุงู**: ุนุฏุฏ ุฑุณุงุฆู ูู ุงูููู
- **ูุงุฆูุฉ ุณูุฏุงุก**: ุฃุฑูุงู ูุญุธูุฑุฉ
- **ุชุดููุฑ**: ุญูุงูุฉ ูุญุชูู ุงูุฑุณุงุฆู
- **ุณุฌู ุงูุนูููุงุช**: ุชุชุจุน ุฌููุน ุงูุฅุฑุณุงูุงุช

## ุงูุฎูุงุตุฉ

ุชู ุจูุฌุงุญ ุฅุถุงูุฉ ููุฒุฉ ุงุฎุชุจุงุฑ ุฅุฑุณุงู ุงูุฑุณุงุฆู:

- โ **ุชุตููู ูุทุงุจู** - ููุง ูู ููุถุญ ูู ุงูุตูุฑุฉ
- โ **API Integration** - ุฑุจุท ูุงูู ูุน `/api/whatsapp/send-message`
- โ **Validation ุฐูู** - ุชุญูู ูู ุตุญุฉ ุงูุจูุงูุงุช
- โ **Error Handling** - ูุนุงูุฌุฉ ุดุงููุฉ ููุฃุฎุทุงุก
- โ **User Experience** - ุชุฌุฑุจุฉ ูุณุชุฎุฏู ุณูุณุฉ
- โ **Type Safety** - Types ูุญุฏุฏุฉ ูุฌููุน ุงูุจูุงูุงุช
- โ **Loading States** - ูุคุดุฑุงุช ุชุญููู ูุงุถุญุฉ
- โ **Toast Messages** - ุฑุณุงุฆู ุชูุจูู ุจุงููุบุฉ ุงูุนุฑุจูุฉ

ุงูููุฒุฉ ุงูุขู ุฌุงูุฒุฉ ููุงุณุชุฎุฏุงู ูุงุฎุชุจุงุฑ ุฅุฑุณุงู ุงูุฑุณุงุฆู! ๐
