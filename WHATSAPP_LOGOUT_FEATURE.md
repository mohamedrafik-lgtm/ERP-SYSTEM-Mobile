# ููุฒุฉ ุชุณุฌูู ุงูุฎุฑูุฌ ูู WhatsApp

## ุงูุชุญุฏูุซุงุช ุงูููุฌุฒุฉ

ุชู ุฅุถุงูุฉ ููุฒุฉ ุชุณุฌูู ุงูุฎุฑูุฌ ูู WhatsApp ูุน ุฑุจุท ูุงูู ูุน Backend API ูุชุญุฏูุซ UI ุชููุงุฆูุงู.

### โ **1. ุฅุถุงูุฉ WhatsAppLogoutResponse Interface**

#### **ููู: `src/types/whatsapp.ts`**
```typescript
export interface WhatsAppLogoutResponse {
  success: boolean;
  message?: string;
  error?: string;
}
```

### โ **2. ุฅุถุงูุฉ logoutWhatsApp Method ูู AuthService**

#### **ููู: `src/services/AuthService.ts`**
```typescript
// WhatsApp Management: Logout from WhatsApp
static async logoutWhatsApp(): Promise<WhatsAppLogoutResponse> {
  try {
    const token = await this.getToken();
    if (!token) {
      throw new Error('Authentication token not found.');
    }

    const url = 'http://10.0.2.2:4000/api/whatsapp/logout';
    console.log('[AuthService] Logging out from WhatsApp at URL:', url);

    const response = await fetch(url, {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${token}`,
        'Content-Type': 'application/json',
      },
    });

    if (!response.ok) {
      if (response.status === 401) {
        await this.clearAuthData();
        throw new Error('Authentication expired. Please login again.');
      }
      const errorText = await response.text();
      throw new Error(errorText || `Failed to logout from WhatsApp: ${response.status}`);
    }

    const responseData = await response.json();
    console.log('[AuthService] WhatsApp logout response:', responseData);
    return responseData;
  } catch (error) {
    console.error('[AuthService] Error logging out from WhatsApp:', error);
    throw error;
  }
}
```

### โ **3. ุฅุถุงูุฉ ูุธููุฉ ุชุณุฌูู ุงูุฎุฑูุฌ ูู WhatsAppManagementScreen**

#### **ุฏุงูุฉ handleWhatsAppLogout:**
```typescript
const handleWhatsAppLogout = async () => {
  Alert.alert(
    'ุชุณุฌูู ุงูุฎุฑูุฌ ูู WhatsApp',
    'ูู ุฃูุช ูุชุฃูุฏ ูู ุชุณุฌูู ุงูุฎุฑูุฌ ูู WhatsAppุ ุณูุชู ูุทุน ุงูุงุชุตุงู ูุณูุญุชุงุฌ ุฅุนุงุฏุฉ ุฑุจุท.',
    [
      { text: 'ุฅูุบุงุก', style: 'cancel' },
      { text: 'ุชุณุฌูู ุงูุฎุฑูุฌ', style: 'destructive', onPress: async () => {
        setIsLoggingOut(true);
        try {
          const response = await AuthService.logoutWhatsApp();
          
          if (response.success) {
            Toast.show({
              type: 'success',
              text1: 'ุชู ุชุณุฌูู ุงูุฎุฑูุฌ',
              text2: response.message || 'ุชู ูุทุน ุงูุงุชุตุงู ูู WhatsApp ุจูุฌุงุญ',
            });
            
            // Update connection status
            setConnectionStatus('disconnected');
            setSendReadiness('pending');
            setStatusData(null);
            
            // Refresh status after logout
            setTimeout(() => {
              loadConnectionStatus();
            }, 1000);
          } else {
            Toast.show({
              type: 'error',
              text1: 'ูุดู ูู ุชุณุฌูู ุงูุฎุฑูุฌ',
              text2: response.error || 'ุญุฏุซ ุฎุทุฃ ูู ุชุณุฌูู ุงูุฎุฑูุฌ',
            });
          }
        } catch (error: any) {
          console.error('Error logging out from WhatsApp:', error);
          Toast.show({
            type: 'error',
            text1: 'ุฎุทุฃ ูู ุชุณุฌูู ุงูุฎุฑูุฌ',
            text2: error.message || 'ุญุฏุซ ุฎุทุฃ ูู ุชุณุฌูู ุงูุฎุฑูุฌ ูู WhatsApp',
          });
        } finally {
          setIsLoggingOut(false);
        }
      }}
    ]
  );
};
```

### โ **4. ุชุญุฏูุซ UI ูุนุฑุถ ุฃุฒุฑุงุฑ ุชุณุฌูู ุงูุฎุฑูุฌ**

#### **ูู WhatsAppStatusCard:**
- **ุฒุฑ "ุฎุฑูุฌ"** ูู ุฃุฒุฑุงุฑ ุงูุฅุฌุฑุงุกุงุช
- **ุชุญุฏูุซ ุงููุต** ุฅูู "ุฌุงุฑู ุงูุฎุฑูุฌ..." ุฃุซูุงุก ุงูุนูููุฉ
- **ุชุบููุฑ ุงูููู** ุฅูู ุฑูุงุฏู ุฃุซูุงุก ุงูุชุญููู
- **ููุน ุงูุถุบุท** ุฃุซูุงุก ุงูุนูููุฉ

#### **ูู ูุณู ุฑุจุท ุงูุญุณุงุจ:**
- **ุฒุฑ ุชุณุฌูู ุงูุฎุฑูุฌ** ูุธูุฑ ููุท ุนูุฏ ุงูุงุชุตุงู
- **ุชุฎุทูุท ุฌูุจู** ูุน ุฒุฑ ุชุญุฏูุซ ุงูุญุงูุฉ
- **ุฃููููุฉ logout** ูุงุถุญุฉ
- **ุญุงูุฉ ุชุญููู** ูุน "ุฌุงุฑู ุงูุฎุฑูุฌ..."

### โ **5. Confirmation Dialog**

#### **ูุงูุฐุฉ ุชุฃููุฏ:**
- **ุนููุงู ูุงุถุญ**: "ุชุณุฌูู ุงูุฎุฑูุฌ ูู WhatsApp"
- **ุฑุณุงูุฉ ุชุญุฐูุฑูุฉ**: ุชูุถุญ ุฃู ุงูุงุชุตุงู ุณูุชู ูุทุนู
- **ุฒุฑ ุฅูุบุงุก**: ูุฅูุบุงุก ุงูุนูููุฉ
- **ุฒุฑ ุชุณุฌูู ุงูุฎุฑูุฌ**: ุจุงูููู ุงูุฃุญูุฑ (destructive)

### โ **6. ุชุญุฏูุซ UI ุจุนุฏ ุชุณุฌูู ุงูุฎุฑูุฌ**

#### **ุชุญุฏูุซุงุช ุชููุงุฆูุฉ:**
- **ุญุงูุฉ ุงูุงุชุตุงู**: ุชุตุจุญ "disconnected"
- **ุฌุงูุฒูุฉ ุงูุฅุฑุณุงู**: ุชุตุจุญ "pending"
- **ูุนูููุงุช ุงูุญุงูุฉ**: ูุชู ูุณุญูุง
- **ุชุญุฏูุซ ุชููุงุฆู**: ุจุนุฏ ุซุงููุฉ ูุงุญุฏุฉ
- **ุฑุณุงูุฉ ูุฌุงุญ**: ุชุฃููุฏ ุชุณุฌูู ุงูุฎุฑูุฌ

## API Endpoint

### **POST /api/whatsapp/logout**

**Request:**
```
POST /api/whatsapp/logout
Authorization: Bearer <token>
Content-Type: application/json
```

**Response Success:**
```json
{
  "success": true,
  "message": "ุชู ุชุณุฌูู ุงูุฎุฑูุฌ ุจูุฌุงุญ"
}
```

**Response Error:**
```json
{
  "success": false,
  "error": "ูุดู ูู ุชุณุฌูู ุงูุฎุฑูุฌ"
}
```

## ุชุฏูู ุงูุนูู

### **1. ุจุฏุก ุชุณุฌูู ุงูุฎุฑูุฌ:**
1. ุงููุณุชุฎุฏู ูุถุบุท ุนูู ุฒุฑ "ุฎุฑูุฌ" ุฃู "ุชุณุฌูู ุงูุฎุฑูุฌ"
2. ุธููุฑ ูุงูุฐุฉ ุชุฃููุฏ
3. ุงููุณุชุฎุฏู ูุคูุฏ ุงูุนูููุฉ

### **2. ุชูููุฐ ุชุณุฌูู ุงูุฎุฑูุฌ:**
1. ุฅุฑุณุงู ุทูุจ POST ุฅูู `/api/whatsapp/logout`
2. ุนุฑุถ ูุคุดุฑ ุงูุชุญููู
3. ุงูุชุธุงุฑ ุงูุงุณุชุฌุงุจุฉ ูู ุงูุฎุงุฏู

### **3. ุชุญุฏูุซ UI:**
1. **ูุฌุงุญ**: ุชุญุฏูุซ ุงูุญุงูุฉ ุฅูู "disconnected"
2. **ูุดู**: ุนุฑุถ ุฑุณุงูุฉ ุฎุทุฃ
3. **ุชุญุฏูุซ ุชููุงุฆู**: ุจุนุฏ ุซุงููุฉ ูุงุญุฏุฉ

### **4. ุงููุชูุฌุฉ:**
1. **ุฑุณุงูุฉ ูุฌุงุญ**: ุชุฃููุฏ ุชุณุฌูู ุงูุฎุฑูุฌ
2. **ุชุญุฏูุซ ุงูุญุงูุฉ**: ูู ุฌููุน ุฃุฌุฒุงุก UI
3. **ุฅุฎูุงุก ุฃุฒุฑุงุฑ**: ุชุณุฌูู ุงูุฎุฑูุฌ ุนูุฏ ุนุฏู ุงูุงุชุตุงู

## ุงูููุฒุงุช ุงูุชูููุฉ

### **๐ ุชุญุฏูุซ ุชููุงุฆู ููู UI:**
- **ุญุงูุฉ ุงูุงุชุตุงู**: ุชุตุจุญ "ุบูุฑ ูุชุตู"
- **ุฌุงูุฒูุฉ ุงูุฅุฑุณุงู**: ุชุตุจุญ "ูู ุงูุงูุชุธุงุฑ"
- **ูุนูููุงุช ุงูุญุงูุฉ**: ูุชู ูุณุญูุง
- **ุฃุฒุฑุงุฑ ุชุณุฌูู ุงูุฎุฑูุฌ**: ุชุฎุชูู ุนูุฏ ุนุฏู ุงูุงุชุตุงู

### **โณ Loading States:**
- **ูุคุดุฑ ุชุญููู**: ูู ุฃุฒุฑุงุฑ ุชุณุฌูู ุงูุฎุฑูุฌ
- **ุชุบููุฑ ุงููุต**: ุฅูู "ุฌุงุฑู ุงูุฎุฑูุฌ..."
- **ุชุบููุฑ ุงูููู**: ุฅูู ุฑูุงุฏู ุฃุซูุงุก ุงูุชุญููู
- **ููุน ุงูุถุบุท**: ุฃุซูุงุก ุงูุนูููุฉ

### **๐ก๏ธ ูุนุงูุฌุฉ ุฃุฎุทุงุก ุดุงููุฉ:**
- **ุฃุฎุทุงุก ุงูุดุจูุฉ**: ูุน ุฑุณุงุฆู ูุงุถุญุฉ
- **ุฃุฎุทุงุก API**: ุนุฑุถ ุฑุณุงูุฉ ุงูุฎุทุฃ ูู ุงูุฎุงุฏู
- **ุฃุฎุทุงุก ุงููุตุงุฏูุฉ**: ุชุณุฌูู ุฎุฑูุฌ ุชููุงุฆู
- **ุงุณุชุฑุฏุงุฏ ุงูุญุงูุฉ**: ุฅุนุงุฏุฉ ุชุนููู loading state

### **๐ฌ ุฑุณุงุฆู ุชูุงุนููุฉ:**
- **ุฑุณุงุฆู ูุฌุงุญ**: ุชุฃููุฏ ุชุณุฌูู ุงูุฎุฑูุฌ
- **ุฑุณุงุฆู ุฎุทุฃ**: ูุตู ูุงุถุญ ูููุดููุฉ
- **ููุงูุฐ ุชุฃููุฏ**: ููุน ุงูุชุณุฌูู ุงูุฎุฑูุฌ ุจุงูุฎุทุฃ
- **ุชูุจููุงุช**: ุจุงููุบุฉ ุงูุนุฑุจูุฉ

## ููุงูุน ุฃุฒุฑุงุฑ ุชุณุฌูู ุงูุฎุฑูุฌ

### **1. ูู WhatsAppStatusCard:**
- **ูููุน**: ุถูู ุฃุฒุฑุงุฑ ุงูุฅุฌุฑุงุกุงุช
- **ูุต**: "ุฎุฑูุฌ" / "ุฌุงุฑู ุงูุฎุฑูุฌ..."
- **ููู**: ุฃุญูุฑ / ุฑูุงุฏู ุฃุซูุงุก ุงูุชุญููู
- **ูุธููุฉ**: ุชุณุฌูู ุฎุฑูุฌ ูุจุงุดุฑ

### **2. ูู ูุณู ุฑุจุท ุงูุญุณุงุจ:**
- **ูููุน**: ุฌูุจุงู ุฅูู ุฌูุจ ูุน ุฒุฑ ุชุญุฏูุซ ุงูุญุงูุฉ
- **ูุต**: "ุชุณุฌูู ุงูุฎุฑูุฌ" / "ุฌุงุฑู ุงูุฎุฑูุฌ..."
- **ููู**: ุฃุญูุฑ
- **ุธููุฑ**: ููุท ุนูุฏ ุงูุงุชุตุงู
- **ูุธููุฉ**: ุชุณุฌูู ุฎุฑูุฌ ูุน ุชุฃููุฏ

## ุงูุงุฎุชุจุงุฑ

### **1. ุงุฎุชุจุงุฑ ุชุณุฌูู ุงูุฎุฑูุฌ:**
- ุชุฃูุฏ ูู ุธููุฑ ุฃุฒุฑุงุฑ ุชุณุฌูู ุงูุฎุฑูุฌ ุนูุฏ ุงูุงุชุตุงู
- ุงุถุบุท ุนูู ุฒุฑ ุชุณุฌูู ุงูุฎุฑูุฌ
- ุชุฃูุฏ ูู ุธููุฑ ูุงูุฐุฉ ุงูุชุฃููุฏ
- ุฃูุฏ ุงูุนูููุฉ ูุชุฃูุฏ ูู ุงููุฌุงุญ

### **2. ุงุฎุชุจุงุฑ Loading States:**
- ุงุถุบุท ุนูู ุฒุฑ ุชุณุฌูู ุงูุฎุฑูุฌ
- ุชุฃูุฏ ูู ุชุบููุฑ ุงููุต ุฅูู "ุฌุงุฑู ุงูุฎุฑูุฌ..."
- ุชุฃูุฏ ูู ุชุบููุฑ ุงูููู ุฅูู ุฑูุงุฏู
- ุชุฃูุฏ ูู ููุน ุงูุถุบุท ุฃุซูุงุก ุงูุชุญููู

### **3. ุงุฎุชุจุงุฑ ุชุญุฏูุซ UI:**
- ุณุฌู ุงูุฎุฑูุฌ ูู WhatsApp
- ุชุฃูุฏ ูู ุชุบููุฑ ุญุงูุฉ ุงูุงุชุตุงู ุฅูู "ุบูุฑ ูุชุตู"
- ุชุฃูุฏ ูู ุฅุฎูุงุก ุฃุฒุฑุงุฑ ุชุณุฌูู ุงูุฎุฑูุฌ
- ุชุฃูุฏ ูู ุชุญุฏูุซ ุฌููุน ุงููุนูููุงุช

### **4. ุงุฎุชุจุงุฑ ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก:**
- ุฌุฑุจ ุชุณุฌูู ุงูุฎุฑูุฌ ูุน ุดุจูุฉ ุบูุฑ ูุชุตูุฉ
- ุชุฃูุฏ ูู ุธููุฑ ุฑุณุงูุฉ ุฎุทุฃ ูุงุถุญุฉ
- ุชุฃูุฏ ูู ุนูุฏุฉ ุงูุญุงูุฉ ุงูุทุจูุนูุฉ
- ุชุฃูุฏ ูู ุฅููุงููุฉ ุงููุญุงููุฉ ูุฑุฉ ุฃุฎุฑู

## ุงูููุฒุงุช ุงูุฅุถุงููุฉ

### **๐ฏ ุชุฃููุฏ ุงูุนูููุฉ:**
- **ูุงูุฐุฉ ุชุฃููุฏ**: ููุน ุงูุชุณุฌูู ุงูุฎุฑูุฌ ุจุงูุฎุทุฃ
- **ุฑุณุงูุฉ ุชุญุฐูุฑูุฉ**: ุชูุถุญ ุนูุงูุจ ุงูุนูููุฉ
- **ุฃุฒุฑุงุฑ ูุงุถุญุฉ**: ุฅูุบุงุก ูุชุฃููุฏ
- **ููู ุชุญุฐูุฑู**: ุฃุญูุฑ ูุฒุฑ ุงูุชุฃููุฏ

### **๐ ุชุญุฏูุซ ุฐูู:**
- **ุชุญุฏูุซ ููุฑู**: ููุญุงูุฉ ุจุนุฏ ุชุณุฌูู ุงูุฎุฑูุฌ
- **ุชุญุฏูุซ ูุคุฌู**: ุจุนุฏ ุซุงููุฉ ูุงุญุฏุฉ ููุชุฃูุฏ
- **ูุณุญ ุงูุจูุงูุงุช**: ูุนูููุงุช ุงูุญุงูุฉ ุงููุฏููุฉ
- **ุฅุนุงุฏุฉ ุชุนููู**: ุฌููุน ุงููุชุบูุฑุงุช

### **๐ฑ ุชุฌุฑุจุฉ ูุณุชุฎุฏู ูุญุณูุฉ:**
- **ุฃุฒุฑุงุฑ ูุชุนุฏุฏุฉ**: ูู ููุงูุน ูุฎุชููุฉ
- **ุญุงูุงุช ูุฎุชููุฉ**: ุญุณุจ ุญุงูุฉ ุงูุงุชุตุงู
- **ุฑุณุงุฆู ูุงุถุญุฉ**: ุจุงููุบุฉ ุงูุนุฑุจูุฉ
- **ุชูุงุนู ุณูุณ**: ุจุฏูู ุชุนููุฏ

## ุงูุฎุทูุงุช ุงูุชุงููุฉ

### **1. ููุฒุงุช ูุชูุฏูุฉ:**
- **ุชุณุฌูู ุฎุฑูุฌ ุชููุงุฆู**: ุนูุฏ ุงููุทุงุน ุงูุงุชุตุงู
- **ุฅุนุงุฏุฉ ุชุณุฌูู ุฏุฎูู**: ุชููุงุฆูุฉ
- **ุณุฌู ุงูุนูููุงุช**: ุชุชุจุน ุชุณุฌููุงุช ุงูุฎุฑูุฌ
- **ุฅุญุตุงุฆูุงุช**: ุนุฏุฏ ูุฑุงุช ุชุณุฌูู ุงูุฎุฑูุฌ

### **2. ุชุญุณููุงุช ุงูุฃูุงู:**
- **ุชุดููุฑ ุงูุจูุงูุงุช**: ุญูุงูุฉ ูุนูููุงุช ุงูุงุชุตุงู
- **ุชุฃููุฏ ุฅุถุงูู**: ููุนูููุงุช ุงูุญุณุงุณุฉ
- **ุญุฏ ุฒููู**: ูููุน ุชุณุฌูู ุงูุฎุฑูุฌ ุงููุชูุฑุฑ
- **ุณุฌู ุฃููู**: ุชุชุจุน ุงูุนูููุงุช ุงููุดุจููุฉ

### **3. ููุฒุงุช ุฅุถุงููุฉ:**
- **ุฅุนุงุฏุฉ ุชุณุฌูู ุฏุฎูู**: ุฒุฑ ุณุฑูุน
- **ุญูุธ ุงูุญุงูุฉ**: ุงุณุชุนุงุฏุฉ ุงูุงุชุตุงู ุงูุณุงุจู
- **ุฅุดุนุงุฑุงุช**: ุนูุฏ ุชุณุฌูู ุงูุฎุฑูุฌ
- **ูุณุฎ ุงุญุชูุงุทู**: ููุฅุนุฏุงุฏุงุช

## ุงูุฎูุงุตุฉ

ุชู ุจูุฌุงุญ ุฅุถุงูุฉ ููุฒุฉ ุชุณุฌูู ุงูุฎุฑูุฌ ูู WhatsApp:

- โ **API Integration** - ุฑุจุท ูุงูู ูุน `/api/whatsapp/logout`
- โ **Confirmation Dialog** - ูุงูุฐุฉ ุชุฃููุฏ ูุงุถุญุฉ
- โ **Loading States** - ูุคุดุฑุงุช ุชุญููู ูู ุงูุฃุฒุฑุงุฑ
- โ **UI Updates** - ุชุญุฏูุซ ุชููุงุฆู ููุญุงูุฉ
- โ **Error Handling** - ูุนุงูุฌุฉ ุดุงููุฉ ููุฃุฎุทุงุก
- โ **Multiple Locations** - ุฃุฒุฑุงุฑ ูู ููุงูุน ูุฎุชููุฉ
- โ **Type Safety** - WhatsAppLogoutResponse interface
- โ **User Experience** - ุชุฌุฑุจุฉ ูุณุชุฎุฏู ุณูุณุฉ

ุงูููุฒุฉ ุงูุขู ุฌุงูุฒุฉ ููุงุณุชุฎุฏุงู ูุชุณุฌูู ุงูุฎุฑูุฌ ูู WhatsApp! ๐
